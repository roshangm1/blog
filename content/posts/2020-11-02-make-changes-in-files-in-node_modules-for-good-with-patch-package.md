---
template: post
title: Make changes in files in node_modules for good with patch-package
slug: patch-package-nodemodules
draft: false
date: 2020-11-02T10:35:57.046Z
description: "A simple introduction to using patch-package for making
  *permanent* changes in the files inside node_modules. No, you don't have to
  fork the repository or wait for pull request to be merged just to make a
  simple change in a library. Not anymore. "
category: blog
tags:
  - react-native
  - patch-package
  - node_modules
---
If you have been working with Javascript, I am sure you have been in a situation where you found a perfect npm library for a feature but you have to make certain changes there because of some compatibility issues or even bugs. 

**What will you do ?** 

I know what. One of these, right ?

* Fork the repository, make changes, send PR and wait for the PR to be merged
* Fork the repository, make changes, install from git or even publish your own npm module and use it.

This would normally be okay for smaller projects/libraries where PRs gets merged quickly or you don't care about publishing yet another *unmaintained* library.

You can use a npm package called [patch-package](https://www.npmjs.com/package/patch-package) that actually lets you make changes in files in node_modules directly and yes you don't have to worry about the changes being deleted after fresh `yarn install`. Sounds cool, right ? 

Recently, I came across the same problem. I had to make a small change inside `react-native` folder inside node_modules to fix an issue. The issue was fixed in new version of `react-native` but I dare not upgrade my react-native project because you know it's still pain in ass to upgrade a react-native project. This is how I used [patch-package](https://www.npmjs.com/package/patch-package) to fix the issue and stay happy. 

Before continuing, let me talk about the problem. The problem is with the image not showing up in iOS app when building with XCode 12. (*This is for the visitors who is here for the solution of this exact problem*.)

First and foremost, you install the package.

`yarn install patch-package`

It's now turn to make changes in our `react-native` code or in other words, **patching the react native code.**

1. Open the file `node_modules/react-native/Libraries/Image/RCTUIImageViewAnimated.m`

   ``
2. Edit the source code as follow:

   From:

   ```
   #pragma mark - CALayerDelegate

   - (void)displayLayer:(CALayer *)layer
   {
     if (_currentFrame) {
       layer.contentsScale = self.animatedImageScale;
       layer.contents = (__bridge id)_currentFrame.CGImage;
     }
   }

   ```

   To:

   ```
   #pragma mark - CALayerDelegate

   - (void)displayLayer:(CALayer *)layer
   {
     if (_currentFrame) {
       layer.contentsScale = self.animatedImageScale;
       layer.contents = (__bridge id)_currentFrame.CGImage;
     } else {
       [super displayLayer:layer];
     }
   }


   ```
3. Now Make **Patch**

   `npx patch-package react-native --use-yarn`
4. Track the **patch files** in git

   `git add patches/*`
5. Add package script for applying patches

   ```
   "scripts": {
     ...
     "postinstall": "patch-package",
   }
   ```

   **DONE! YES DONE!**

   From now onwards, whenever you install new packages, it will patch from all your patch files. Voila!\
   \
   Note: I used `react-native` library as an example here but you can apply this technique to any other libraries.\
   \
   Thanks for reading! See you in my next blog.